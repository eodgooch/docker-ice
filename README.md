# Ice, Ice Baby 

This project leverages Docker to create images that run [Netflix's AWS Usage tool, Ice](https://github.com/Netflix/ice). From [Netflix's Ice repository](https://github.com/Netflix/ice) introduction:

> Ice provides a birds-eye view of our large and complex cloud landscape
> from a usage and cost perspective. Cloud resources are dynamically
> provisioned by dozens of service teams within the organization and any
> static snapshot of resource allocation has limited value. The ability
> to trend usage patterns on a global scale, yet decompose them down to
> a region, availability zone, or service team provides incredible
> flexibility. Ice allows us to quantify our AWS footprint and to make
> educated decisions regarding reservation purchases and reallocation of
> resources.
> 
> Ice is a Grails project. It consists of three parts: processor, reader
> and UI. Processor processes the Amazon detailed billing file into data
> readable by reader. Reader reads data generated by processor and
> renders them to UI. UI queries reader and renders interactive graphs
> and tables in the browser.

More information and screenshots can be found on the [project's git page](https://github.com/Netflix/ice). 

## What is this repository?

A fork of [jonbrouse/docker-ice](https://github.com/jonbrouse/docker-ice) adapted for Mesos & Marathon

This repository seeks to ease the installation and configuration of Ice to be deployed on Mesos and Marathon. 

# Getting Started

## Prerequisites 

 - Sign up for Amazon's programmatic billing access [here](http://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/detailed-billing-reports.html) to receive detailed billing(hourly) reports. Verify you receive monthly billing file in the following format: <accountid>-aws-billing-detailed-line-items-<year>-<month>.csv.zip.

## Marathon Setup
 
 ```javascript
 {
     "id": "netflix-ice",
     "env": {
         "BILLING_BUCKET": "",
         "WORK_BUCKET": "",
         "COMPANY_NAME": "",
         "ACCESS_KEY_ID": "",
         "SECRET_KEY": "",
         "ACCOUNT_NUM": ""
     },
     "container": {
         "docker": {
             "image": "eodgooch/docker-ice:marathon-1.0.0",
             "network": "BRIDGE",
             "portMappings": [
               { "containerPort": 8080, "hostPort": 0, "servicePort": 8001, "protocol": "tcp" }
             ]
         },
         "type": "DOCKER"
     },
     "cpus": 1,
     "mem": 1024,
     "instances": 1,
     "healthChecks": [
     {
       "protocol": "HTTP",
       "portIndex": 0,
       "path": "/",
       "gracePeriodSeconds": 5,
       "intervalSeconds": 20,
       "maxConsecutiveFailures": 3
     }
   ]
 }
 ```
 
 - Open `ice/assets/ice.properties` and set any additional parameters you require.
 
 - Docker `ENTRYPOINT` is `bootstrap.sh` 
 
More information on the configurations can be found on the [project's git page](https://github.com/Netflix/ice). 

## Base Docker Containers

- The Ice container's base image is a [Java 7 container](https://registry.hub.docker.com/u/jonbrouse/java/).
